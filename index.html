<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extractor de Acordes y Visualizador</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Victor+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="importmap">
    {
      "imports": {
        "tone": "https://esm.sh/tone@^15.0.4"
      }
    }
    </script>
</head>
<body>
    <div id="app">
        
        <nav class="tabs">
            <button id="visualizer-tab" class="tab active">Visualizador</button>
            <button id="extractor-tab" class="tab">Extractor</button>
            <button id="composer-tab" class="tab">Compositor</button>
        </nav>

        <main id="visualizer-mode" class="mode-content active">
             <div class="controls">
                <div class="select-wrapper">
                    <label for="root-note-select">Nota Raíz</label>
                    <select id="root-note-select"></select>
                </div>
                <div class="select-wrapper">
                    <label for="chord-type-select">Tipo de Acorde</label>
                    <select id="chord-type-select"></select>
                </div>
                <div class="select-wrapper">
                    <label for="visualizer-bass-note-select">Bajo en (Opcional)</label>
                    <select id="visualizer-bass-note-select"></select>
                </div>
                <div class="select-wrapper">
                    <label for="visualizer-inversion-select">Inversión</label>
                    <select id="visualizer-inversion-select"></select>
                </div>
            </div>
            <div class="chord-display-header">
                <div id="visualizer-modifications-editor" class="modifications-container"></div>
                <h2 id="chord-name"></h2>
                <button id="visualizer-play-btn" class="play-btn" aria-label="Reproducir acorde">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" fill="currentColor"><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg>
                </button>
            </div>
            <div id="piano-container">
                <div class="piano" aria-label="Piano virtual">
                </div>
            </div>
        </main>

        <main id="extractor-mode" class="mode-content">
             <p class="description" style="max-width: 650px;">Pega la letra y los acordes de una canción. Haz clic en un acorde para ver su diagrama y escucharlo.</p>
            <textarea id="song-input" placeholder="Pega o escribe tu canción aquí...."></textarea>
            
            <div class="extractor-controls-container">
                <div class="extractor-actions-left">
                    <button id="process-song-btn" class="button-primary">Analizar</button>
                    <button id="add-to-composer-btn" class="button-secondary" disabled>Añadir al Compositor</button>
                    <button id="clear-extractor-btn" class="button-secondary">Limpiar</button>
                </div>
                <div class="extractor-actions-right">
                    <div id="transposition-controls" class="transposition-controls" style="display: none;">
                        <button id="transpose-down-btn" class="button-secondary">-</button>
                        <span id="transposition-display">Original</span>
                        <button id="transpose-up-btn" class="button-secondary">+</button>
                    </div>
                </div>
            </div>
            
            <div id="extractor-loader" class="loader-container" style="display: none;">
                <div class="spinner"></div>
                <p>Analizando...</p>
            </div>
            <div id="song-output" class="song-sheet-container">
            </div>
        </main>

        <main id="composer-mode" class="mode-content">
            <div class="composition-header">
                <div class="piano-and-name-container">
                    <h2 id="composer-chord-name-display" class="chord-name-display"></h2>
                    <div id="composer-piano-display" class="piano-container-small">
                    </div>
                </div>
                <div class="composer-controls-group">
                    <div id="composer-transposition-controls" class="controls">
                        <button id="composer-transpose-down-btn" class="button-secondary">-</button>
                        <span id="composer-transposition-display">Original</span>
                        <button id="composer-transpose-up-btn" class="button-secondary">+</button>
                    </div>
                    <div class="composer-file-controls controls">
                        <button id="export-song-btn" class="button-secondary button-export">Exportar</button>
                        <button id="import-song-btn" class="button-secondary button-import">Importar</button>
                    </div>
                </div>
            </div>
            <div id="composition-output">
            </div>
            <div id="chord-insertion-indicator" class="insert-placeholder" style="display: none;">+</div>
        </main>

        <div id="chord-inspector-overlay"></div>
        <div id="chord-inspector-modal">
            <div class="inspector-header">
                <h3 id="chord-inspector-title"></h3>
                <button id="chord-inspector-play-btn" class="play-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" fill="currentColor"><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg>
                </button>
                <!-- --- CONTENEDOR DE BOTONES DE ACCIÓN --- -->
                <div class="inspector-actions">
                    <button id="chord-inspector-save-btn" class="button-primary">Guardar</button>
                    <button id="chord-inspector-insert-btn" class="button-primary">Insertar</button>
                    <button id="chord-inspector-delete-btn" class="button-secondary">Eliminar</button>
                </div>
                <button id="chord-inspector-close-btn">×</button>
            </div>

            <div class="inspector-controls">
                <div class="select-wrapper">
                    <label for="chord-inspector-root-note-select">Nota Raíz</label>
                    <select id="chord-inspector-root-note-select"></select>
                </div>
                <div class="select-wrapper">
                    <label for="chord-inspector-type-select">Tipo de Acorde</label>
                    <select id="chord-inspector-type-select"></select>
                </div>
                <div class="select-wrapper">
                    <label for="chord-inspector-bass-note-select">Bajo en (Opcional)</label>
                    <select id="chord-inspector-bass-note-select"></select>
                </div>
                <div class="select-wrapper">
                    <label for="chord-inspector-inversion-select">Inversión</label>
                    <select id="chord-inspector-inversion-select"></select>
                </div>
            </div>
            
            <div id="chord-inspector-modifications-editor" class="modifications-container"></div>
            
            <div id="chord-inspector-piano"></div>
        </div>
    </div>
    <script type="module" src="/src/main.tsx"></script>
    <div id="global-tooltip" class="global-chord-tooltip"></div>
</body>
</html>
